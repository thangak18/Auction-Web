{{#section 'js'}}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById("formResetPass").addEventListener("submit", function(e) {
        e.preventDefault();
        
        const newPass = document.getElementById("new_password").value;
        const confirmPass = document.getElementById("confirm_new_password").value;
        // 1. Validate không được để trống
        if(newPass.trim() === "" || confirmPass.trim() === "") {
            Swal.fire({ 
                icon: 'error', 
                title: 'Incomplete', 
                text: 'Please fill in all password fields.' 
            });
            return;
        }
        // 2. Validate mật khẩu trùng khớp
        if(newPass !== confirmPass) {
             Swal.fire({ 
                 icon: 'error', 
                 title: 'Mismatch', 
                 text: 'Passwords do not match. Please try again.' 
             });
             return;
        }

        // UX: Disable nút submit khi đang gửi
        const btn = e.target.querySelector("button[type='submit']");
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Updating...';
        btn.disabled = true;

        e.target.submit();
    });
</script>
{{/section}}

<section class="py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6">
        
        <!-- Header -->
        <div class="mb-4 text-center">
          <h2 class="text-uppercase">Reset Password</h2>
          <p class="text-muted">
            Please create a new password for your account associated with <strong>{{email}}</strong>.
          </p>
        </div>
        
        {{!-- Hiển thị lỗi từ Server nếu có --}}
        {{#if error_message}}
        <div class="alert alert-danger text-center">
            <i class="bi bi-exclamation-octagon-fill"></i> {{error_message}}
        </div>
        {{/if}}

        <form method="post" action="/account/reset-password" id="formResetPass">
          <!-- Hidden Email Field (Quan trọng để biết đổi pass cho ai) -->
          <input type="hidden" name="email" value="{{email}}">

          <!-- New Password -->
          <div class="mb-3">
            <label for="new_password" class="form-label text-uppercase small">New Password</label>
            <input type="password" class="form-control" id="new_password" name="new_password" 
                   placeholder="Enter new password" autofocus>
          </div>

          <!-- Confirm Password -->
          <div class="mb-4">
            <label for="confirm_new_password" class="form-label text-uppercase small">Confirm Password</label>
            <input type="password" class="form-control" id="confirm_new_password" name="confirm_new_password" 
                   placeholder="Re-enter new password">
          </div>

          <!-- Submit Button -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-dark text-uppercase py-2">
              Update Password
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</section>